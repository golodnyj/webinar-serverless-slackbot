# Шаг 7. Реализуем команду интегрированную в Slack, и работающую с YDB

# Шаг 7.1. Получаем переменные для работы с YDB

В обзоре вашей YBD есть секция `YDB эндпоинт`,
вам нужно будет запомнить значение `Эндпоинт` и `База данных` для организации подключения из функции.

При этом, переменная `ENDPOINT` будет вида `grpcs://ydb.serverless.yandexcloud.net:1234`, а переменную `DATABASE` обязательно начинать с  `/ru-central1/...`, третья переменная `USE_METADATA_CREDENTIALS` в нашем случае выставляется равной `1` 

# Шаг 7.2. Создаем функцию

Перейдите в каталог и выберете сервис Cloud Functions. Нажмите кнопку `Создать функцию`.
Задайте имя `for-slack-bot-what-kind-of-coffee`.
Выберете среду выполнения `python37`.

Создайте файл `requirements.txt`
Поменяйте содержимое файлов `requirements.txt` и `index.py` в консоле на содержание аналогичных файлов из текущего каталога. Укажите точку входа `index.handler`. Увеличте таймаут до 5 секунд.

Обязательно укажите сервисный аккаунт, и переменные `SLACK_BOT_TOKEN`, `SLACK_SIGNING_SECRET` полученные ранее. Добавьте еще три переменные для работы с YDB — `ENDPOINT`, `DATABASE` , `USE_METADATA_CREDENTIALS`. Нажмите кнопку — `Создать версию`.
Запомните идентификатор вашей функции.

# Шаг 7.3. Внесите изменения в API Gateway

Перейдите в каталог и выберете сервис API Gateway. Выберете `for-slack-bot` и начните его редактирование. Вставьте секцию `/what-kind-of-coffee` со всем ее содержимым из файла `for-slack-bot.yml` спецификацию.

Обязательно замените `IDYOURFUNCTIONCOFFEE` на id созданной функции и `IDYOURACCOUNT` на id вашего сервисного аккаунта, созданного ранее. Сохраните изменения.

# Шаг 7.4. Конфигурирование команды в Slack

В панель управления вашим Slack workspace — https://api.slack.com/ выберете созданное вами приложение `ServerlessBotApp`. В секции `Slash Commands` нажмите `Create New Command`.

В поле `Command` введите `/what-kind-of-coffee` в поле  `Request URL` вставьте адрес вашего API Gateway дополнив его `/what-kind-of-coffee` можете также заполнить поле `Short Description`. Нажмите `Save`.

Следуя появившейся инструкциии переинстиллируйте Slack-приложение. После этого в вашем `workspace` появится возможность вызвать эту команду.

## Видео

https://youtu.be/Pdwqqws7-Kg